syntax = "proto3";

package proto.scg.tenant.v1;

import "google/protobuf/timestamp.proto";

option go_package = "github.com/next-trace/scg-contracts/gen/go/proto/scg/tenant/v1;tenantv1";

service TenantControlPlaneService {
  rpc CreateTenant(CreateTenantRequest) returns (CreateTenantResponse);
  rpc UpdateTenant(UpdateTenantRequest) returns (UpdateTenantResponse);
  rpc DeactivateTenant(DeactivateTenantRequest) returns (DeactivateTenantResponse);

  rpc AddTenantMember(AddTenantMemberRequest) returns (AddTenantMemberResponse);
  rpc RemoveTenantMember(RemoveTenantMemberRequest) returns (RemoveTenantMemberResponse);
  rpc ChangeTenantMemberRole(ChangeTenantMemberRoleRequest) returns (ChangeTenantMemberRoleResponse);

  rpc PublishPolicySet(PublishPolicySetRequest) returns (PublishPolicySetResponse);
  rpc ActivatePolicySet(ActivatePolicySetRequest) returns (ActivatePolicySetResponse);

  rpc UpsertConnectorConfig(UpsertConnectorConfigRequest) returns (UpsertConnectorConfigResponse);
  rpc DisableConnector(DisableConnectorRequest) returns (DisableConnectorResponse);

  rpc SetFeatureFlag(SetFeatureFlagRequest) returns (SetFeatureFlagResponse);

  rpc GetTenant(GetTenantRequest) returns (GetTenantResponse);
  rpc ListTenants(ListTenantsRequest) returns (ListTenantsResponse);
  rpc GetTenantMember(GetTenantMemberRequest) returns (GetTenantMemberResponse);
  rpc ListTenantMembers(ListTenantMembersRequest) returns (ListTenantMembersResponse);

  rpc GetActivePolicySet(GetActivePolicySetRequest) returns (GetActivePolicySetResponse);
  rpc ListPolicySets(ListPolicySetsRequest) returns (ListPolicySetsResponse);
  rpc GetPolicySet(GetPolicySetRequest) returns (GetPolicySetResponse);

  rpc GetConnectorConfig(GetConnectorConfigRequest) returns (GetConnectorConfigResponse);
  rpc ListConnectors(ListConnectorsRequest) returns (ListConnectorsResponse);
  rpc GetFeatureFlags(GetFeatureFlagsRequest) returns (GetFeatureFlagsResponse);

  rpc Liveness(LivenessRequest) returns (LivenessResponse);
  rpc Readiness(ReadinessRequest) returns (ReadinessResponse);
}

message Tenant {
  string tenant_id = 1 [json_name = "tenant_id"];
  string tenant_key = 2 [json_name = "tenant_key"];
  string name = 3 [json_name = "name"];
  bool active = 4 [json_name = "active"];
  google.protobuf.Timestamp created_at = 5 [json_name = "created_at"];
  google.protobuf.Timestamp updated_at = 6 [json_name = "updated_at"];
}

message TenantMember {
  string tenant_id = 1 [json_name = "tenant_id"];
  string user_id = 2 [json_name = "user_id"];
  string role = 3 [json_name = "role"];
  bool active = 4 [json_name = "active"];
  google.protobuf.Timestamp created_at = 5 [json_name = "created_at"];
  google.protobuf.Timestamp updated_at = 6 [json_name = "updated_at"];
}

message PolicySet {
  string tenant_id = 1 [json_name = "tenant_id"];
  string policy_set_id = 2 [json_name = "policy_set_id"];
  int64 version = 3 [json_name = "version"];
  string payload_json = 4 [json_name = "payload_json"];
  bool active = 5 [json_name = "active"];
  google.protobuf.Timestamp created_at = 6 [json_name = "created_at"];
  google.protobuf.Timestamp updated_at = 7 [json_name = "updated_at"];
}

message ConnectorConfig {
  string tenant_id = 1 [json_name = "tenant_id"];
  string connector = 2 [json_name = "connector"];
  string config_json = 3 [json_name = "config_json"];
  bool enabled = 4 [json_name = "enabled"];
  google.protobuf.Timestamp created_at = 5 [json_name = "created_at"];
  google.protobuf.Timestamp updated_at = 6 [json_name = "updated_at"];
}

message FeatureFlag {
  string tenant_id = 1 [json_name = "tenant_id"];
  string flag = 2 [json_name = "flag"];
  bool enabled = 3 [json_name = "enabled"];
  google.protobuf.Timestamp updated_at = 4 [json_name = "updated_at"];
}

message CreateTenantRequest {
  string tenant_id = 1 [json_name = "tenant_id"];
  string tenant_key = 2 [json_name = "tenant_key"];
  string name = 3 [json_name = "name"];
}
message CreateTenantResponse { Tenant tenant = 1 [json_name = "tenant"]; }

message UpdateTenantRequest {
  string tenant_id = 1 [json_name = "tenant_id"];
  string name = 2 [json_name = "name"];
}
message UpdateTenantResponse { Tenant tenant = 1 [json_name = "tenant"]; }

message DeactivateTenantRequest {
  string tenant_id = 1 [json_name = "tenant_id"];
  string reason = 2 [json_name = "reason"];
}
message DeactivateTenantResponse { Tenant tenant = 1 [json_name = "tenant"]; }

message AddTenantMemberRequest {
  string tenant_id = 1 [json_name = "tenant_id"];
  string user_id = 2 [json_name = "user_id"];
  string role = 3 [json_name = "role"];
}
message AddTenantMemberResponse { TenantMember member = 1 [json_name = "member"]; }

message RemoveTenantMemberRequest {
  string tenant_id = 1 [json_name = "tenant_id"];
  string user_id = 2 [json_name = "user_id"];
}
message RemoveTenantMemberResponse { TenantMember member = 1 [json_name = "member"]; }

message ChangeTenantMemberRoleRequest {
  string tenant_id = 1 [json_name = "tenant_id"];
  string user_id = 2 [json_name = "user_id"];
  string role = 3 [json_name = "role"];
}
message ChangeTenantMemberRoleResponse { TenantMember member = 1 [json_name = "member"]; }

message PublishPolicySetRequest {
  string tenant_id = 1 [json_name = "tenant_id"];
  string policy_set_id = 2 [json_name = "policy_set_id"];
  string payload_json = 3 [json_name = "payload_json"];
}
message PublishPolicySetResponse { PolicySet bundle = 1 [json_name = "bundle"]; }

message ActivatePolicySetRequest {
  string tenant_id = 1 [json_name = "tenant_id"];
  string policy_set_id = 2 [json_name = "policy_set_id"];
}
message ActivatePolicySetResponse { PolicySet bundle = 1 [json_name = "bundle"]; }

message UpsertConnectorConfigRequest {
  string tenant_id = 1 [json_name = "tenant_id"];
  string connector = 2 [json_name = "connector"];
  string config_json = 3 [json_name = "config_json"];
  bool enabled = 4 [json_name = "enabled"];
}
message UpsertConnectorConfigResponse { ConnectorConfig connector = 1 [json_name = "connector"]; }

message DisableConnectorRequest {
  string tenant_id = 1 [json_name = "tenant_id"];
  string connector = 2 [json_name = "connector"];
}
message DisableConnectorResponse { ConnectorConfig connector = 1 [json_name = "connector"]; }

message SetFeatureFlagRequest {
  string tenant_id = 1 [json_name = "tenant_id"];
  string flag = 2 [json_name = "flag"];
  bool enabled = 3 [json_name = "enabled"];
}
message SetFeatureFlagResponse { FeatureFlag feature_flag = 1 [json_name = "feature_flag"]; }

message GetTenantRequest { string tenant_id = 1 [json_name = "tenant_id"]; }
message GetTenantResponse { Tenant tenant = 1 [json_name = "tenant"]; }

message ListTenantsRequest {
  int32 page_size = 1 [json_name = "page_size"];
  string page_token = 2 [json_name = "page_token"];
}
message ListTenantsResponse {
  repeated Tenant tenants = 1 [json_name = "tenants"];
  string next_page_token = 2 [json_name = "next_page_token"];
}

message GetTenantMemberRequest {
  string tenant_id = 1 [json_name = "tenant_id"];
  string user_id = 2 [json_name = "user_id"];
}
message GetTenantMemberResponse { TenantMember member = 1 [json_name = "member"]; }

message ListTenantMembersRequest {
  string tenant_id = 1 [json_name = "tenant_id"];
  int32 page_size = 2 [json_name = "page_size"];
  string page_token = 3 [json_name = "page_token"];
}
message ListTenantMembersResponse {
  repeated TenantMember members = 1 [json_name = "members"];
  string next_page_token = 2 [json_name = "next_page_token"];
}

message GetActivePolicySetRequest { string tenant_id = 1 [json_name = "tenant_id"]; }
message GetActivePolicySetResponse { PolicySet bundle = 1 [json_name = "bundle"]; }

message ListPolicySetsRequest {
  string tenant_id = 1 [json_name = "tenant_id"];
  int32 page_size = 2 [json_name = "page_size"];
  string page_token = 3 [json_name = "page_token"];
}
message ListPolicySetsResponse {
  repeated PolicySet bundles = 1 [json_name = "bundles"];
  string next_page_token = 2 [json_name = "next_page_token"];
}

message GetPolicySetRequest {
  string tenant_id = 1 [json_name = "tenant_id"];
  string policy_set_id = 2 [json_name = "policy_set_id"];
}
message GetPolicySetResponse { PolicySet bundle = 1 [json_name = "bundle"]; }

message GetConnectorConfigRequest {
  string tenant_id = 1 [json_name = "tenant_id"];
  string connector = 2 [json_name = "connector"];
}
message GetConnectorConfigResponse { ConnectorConfig connector_config = 1 [json_name = "connector_config"]; }

message ListConnectorsRequest { string tenant_id = 1 [json_name = "tenant_id"]; }
message ListConnectorsResponse { repeated ConnectorConfig connectors = 1 [json_name = "connectors"]; }

message GetFeatureFlagsRequest { string tenant_id = 1 [json_name = "tenant_id"]; }
message GetFeatureFlagsResponse { repeated FeatureFlag feature_flags = 1 [json_name = "feature_flags"]; }

message LivenessRequest {}
message LivenessResponse { bool ok = 1 [json_name = "ok"]; }

message ReadinessRequest {}
message DependencyStatus {
  string name = 1 [json_name = "name"];
  bool ok = 2 [json_name = "ok"];
  string message = 3 [json_name = "message"];
}
message ReadinessResponse {
  bool ok = 1 [json_name = "ok"];
  repeated DependencyStatus dependencies = 2 [json_name = "dependencies"];
}
